[[PageOutline]]

= How to make custom plugins (bleeding edge) =

'''API is not yet stabilized. Expect some changes to happen. Yes, documentation is a very messy ... feel free to improve'''

=== Resources ===

 * [http://doc.flexget.com generated API documents]
 * [wiki:Developers/Mock how to use mock data via configuration file]
 * [wiki:Developers/TDD test driven development how to]
 * [http://coverage.flexget.com unit test coverage]

== Resources, autogenerated from wiki ==

[[ListTagged(developers)]]

Making custom plugins should be easy for anyone with some python experience.

If you're working on good re-usable plugin I'd be more than happy to include it in official distribution. [wiki:Contact] me for subversion write permissions.

== Registering plugins ==

Plugins are registered by calling {{{register_plugin}}} method.

{{{
register_plugin(<class name>, '<keyword>', [parameters])
}}}

You can also pass some optional named arguments

{{{
Optional arguments:
    builtin     - set to True if plugin should be executed always
    group       - group name this plugin belongs to
    groups      - list of group names this plugin belongs to
}}}

Example:
{{{
register_plugin(FilterRegexp, 'regexp', priorities={'filter': 128})
}}}

== Phase methods ==

Listed in order of execution.

 * on_feed_start(self, feed)
 * on_feed_input(self, feed)
 * on_feed_metainfo(self, feed)
 * on_feed_filter(self, feed)
 * on_feed_download(self, feed)
 * on_feed_modify(self, feed)
 * on_feed_output(self, feed)
 * on_feed_exit(self, feed)

When multiple plugins of same phase type are enabled for a feed, the priority decorator can be used to define execution order. Default is 128. Larger number, higher priority. e.g.
{{{
@priority(120)
on_feed_filter(self, feed):
    pass
}}}
=== Feed execution UML ===

Only most important phases shown.

{{{
#!SequenceDiagram
participant Feed
participant Input
participant Filter
participant Download
participant Output

Feed->Input: Execute Input(s)
Input->Feed: Add entries
Feed->Feed: Purge Rejected, Failed
Feed->Filter: Execute Filter(s)
Filter->Feed: Reject entries
Filter->Feed: Accept entries
Feed->Feed: Purge Rejected, Failed
Feed->Download: Execute Download(s)
Feed->Feed: Purge Rejected, Failed
Feed->Output: Execute Output(s)
}}}

=== Other phases ===

 * on_feed_abort(self, feed)

=== Application phases ===

 * on_process_start(self, feed)
 * on_process_end(self, feed)

These are triggered on startup and shutdown, not between feeds.

=== Registering custom phases ===

Plugins may create new feed phases, signature is on_feed_<name>(self, feed).

=== Adding commandline parameters ===

You can also add more commandline parameters. Check existing plugins. See [http://optik.sourceforge.net/ Optik homepage] for documentation.

== Feed class ==

Feed is a class that represents one feed in configuration file.

=== Feed's attributes: ===

 name::
  name of the feed

 config::
  feed specific configuration (dict).

 entries::
  list containing [wiki:DevelopersEntry entries].

 accepted::
  list containing accepted entries

 rejected::
  list containing rejected entries

 simple_persistence::
  provides easy key, value persistence for modules that do not require the full SQLAlchemy capabilities.

You shouldn't modify name or config as they are used by other modules.

=== Feed methods ===

 accept(entry, [reason])::
  Mark entry accepted. Can still be rejected

 reject(entry, [reason])::
  Mark entry to be removed. It will be removed from feed once module event returns.

 fail(entry)::
  Mark entry to be failed (ie. download 404 etc)

 get_input_url(keyword)::
  Helper method for modules. Return url for a specified keyword.
  Supports configuration in following forms:[[BR]]
  ..<keyword>: <address>[[BR]]
  and[[BR]]
  ..<keyword>:[[BR]]
  ....url: <address>
  '''Will be moved in 1.0'''

== Manager class ==

Accessible trough feed.manager

 unit_test::
  True when executing unit tests

== Plugin class ==

''todo: write ''

== Unit testing ==

=== Run tests ===

{{{
bin/paver test
}}}

Argument {{{--online}}} can be used to enable online tests

=== Run a single test ===

{{{
bin/nosetests tests/__init__.py:TestDisableBuiltins --where tests
}}}

== Running IPython inside !FlexGet ==

First install IPython

{{{
bin/easy_install ipython
}}}

And then place this where you wish to hack:

{{{
from IPython.Shell import IPShellEmbed
ipshell = IPShellEmbed([])
ipshell()
}}}